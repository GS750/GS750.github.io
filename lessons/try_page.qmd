---
title: "TRY out page"
webr:  
  show-startup-message: true    # Display status of webR initialization
  packages: ['ggplot2'] # Pre-install dependency
---

## What is Causal Inference


```{webr-r}
#| context: setup
library(tidyverse)
```

<br>

## Question

Compute the difference in means between treated and control groups.

<!-- Stylish Reveal Button -->
<style>
.reveal-btn {
  background-color: #4CAF50; /* green */
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  transition: background-color 0.3s, transform 0.2s;
}

.reveal-btn:hover {
  background-color: #45a049;  /* darker green on hover */
  transform: scale(1.05);     /* slight grow effect */
}

.reveal-btn:active {
  transform: scale(0.98);     /* shrink a little when clicked */
}
</style>

<button class="reveal-btn" onclick="document.getElementById('answer1').style.display='block'">
Reveal Correct Answer
</button>

<div id="answer1" style="display:none; margin-top:10px; padding:10px; border-left:4px solid #4CAF50; background:#f0fff0; border-radius:5px;">
üí° <strong>Answer:</strong> The difference in means is approximately <strong>2.1</strong> ‚Äî same as the regression coefficient on <code>z</code>.
</div>







## Instructions

Match each description on the left with the correct variable type on the right.  

- **Treatment** = variable that we manipulate  
- **Outcome** = variable we measure

| Description | Match |
|-------------|-------|
| 1. Did the student receive the new teaching method? | ‚ùì |
| 2. Test score after the intervention | ‚ùì |
| 3. Whether the patient got a medication | ‚ùì |
| 4. Blood pressure after treatment | ‚ùì |

<details>
<summary>Reveal Answers</summary>

| Description | Answer |
|-------------|-------|
| 1. Did the student receive the new teaching method? | Treatment |
| 2. Test score after the intervention | Outcome |
| 3. Whether the patient got a medication | Treatment |
| 4. Blood pressure after treatment | Outcome |

</details>

## Drag-and-Drop Matching: Treatment vs Outcome



<div class="drag-exercise" {=html} style="font-family:sans-serif;">
  <style>
    /* Draggable items */
    .drag-item {
      padding: 10px;
      margin: 5px;
      border: 2px solid #555;
      border-radius: 8px;
      background-color: #f9f9f9;
      cursor: grab;
      transition: background-color 0.2s, transform 0.1s;
    }
    .drag-item:active {
      transform: scale(0.98);
      background-color: #e0e0e0;
    }

    /* Droppable boxes */
    .drop-box {
      min-height: 120px;
      border: 2px dashed #555;
      border-radius: 10px;
      padding: 10px;
      overflow:auto;
      display:flex;
      flex-direction: column;
      gap:5px;
      background-color: #f0f8ff;
      transition: background-color 0.2s;
    }
    .drop-box.treatment { border-color: #3498db; background-color:#eaf4fc;}
    .drop-box.outcome   { border-color: #2ecc71; background-color:#e8f9ea;}
    .drop-box.highlight { background-color: #fffae6; }

    /* Layout */
    #drag-container { display:flex; justify-content:space-between; width:600px; }
    #left { width:45%; }
    #right { width:45%; }

    /* Button */
    .check-btn {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.2s;
      margin-top:10px;
    }
    .check-btn:hover { background-color: #45a049; transform: scale(1.05);}
    .check-btn:active { transform: scale(0.98);}
  </style>

  <div id="drag-container">
    <!-- Left column: draggable items -->
    <div id="left">
      <div draggable="true" id="item1" class="drag-item">Student got new method</div>
      <div draggable="true" id="item2" class="drag-item">Test score after intervention</div>
      <div draggable="true" id="item3" class="drag-item">Patient received medication</div>
      <div draggable="true" id="item4" class="drag-item">Blood pressure after treatment</div>
    </div>

    <!-- Right column: droppable boxes -->
    <div id="right">
      <div id="treatment" class="drop-box treatment" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Treatment</strong>
      </div>
      <div id="outcome" class="drop-box outcome" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Outcome</strong>
      </div>
    </div>
  </div>

  <button class="check-btn" onclick="checkAnswer()">Check Answers</button>
  <div id="result" style="margin-top:10px; font-weight:bold;"></div>

  <script>
    // Allow drop only on drop-box
    function allowDrop(ev) { 
      ev.preventDefault(); 
      if (!ev.target.classList.contains('drop-box')) return false;
    }

    // Drag start
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }

    // Drop: always append to nearest drop-box
    function drop(ev) { 
      ev.preventDefault(); 
      const draggedId = ev.dataTransfer.getData("text");
      const draggedEl = document.getElementById(draggedId);

      let dropTarget = ev.target;
      while(dropTarget && !dropTarget.classList.contains('drop-box')) {
        dropTarget = dropTarget.parentElement;
      }

      if(dropTarget) {
        dropTarget.appendChild(draggedEl);
      }
    }

    // Attach dragstart events
    document.querySelectorAll('#left .drag-item').forEach(div => div.addEventListener('dragstart', drag));

    // Check answers
    function checkAnswer() {
      const correct = { "item1":"treatment", "item2":"outcome", "item3":"treatment", "item4":"outcome" };
      let score = 0;
      for (let item in correct) {
        const parentId = document.getElementById(item).parentElement.id;
        if(parentId === correct[item]) { score += 1; }
      }
      document.getElementById('result').innerText = "You got " + score + " out of 4 correct!";
    }
  </script>
</div>


## Matching Exercise: Treatment vs Outcome

Drag each variable to the correct box, then use the button below to calculate the effect of your treatment.

<div {=html} style="display:flex; justify-content:space-between; width:600px; margin-bottom:20px;">
  <div id="left" style="width:45%;">
    <div draggable="true" id="var1" style="padding:5px; margin:5px; border:1px solid black;">Student got new method</div>
    <div draggable="true" id="var2" style="padding:5px; margin:5px; border:1px solid black;">Test score after intervention</div>
  </div>
  <div id="right" style="width:45%;">
    <div id="treatment" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed blue; margin-bottom:10px; padding:5px;">
      <strong>Treatment</strong>
    </div>
    <div id="outcome" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed green; padding:5px;">
      <strong>Outcome</strong>
    </div>
  </div>
</div>

<button onclick="computeEffect()">Compute Effect</button>
<div id="effectResult" style="margin-top:10px;"></div>

<script>
function allowDrop(ev) { ev.preventDefault(); }
function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
function drop(ev) { ev.preventDefault(); ev.target.appendChild(document.getElementById(ev.dataTransfer.getData("text"))); }

// attach drag events
document.querySelectorAll('#left div').forEach(div => div.addEventListener('dragstart', drag));

function computeEffect() {
  // find which div is in treatment/outcome boxes
  let treatment = document.getElementById("treatment").children[1]?.innerText || "";
  let outcome   = document.getElementById("outcome").children[1]?.innerText || "";
  
  if(treatment === "" || outcome === "") {
    document.getElementById("effectResult").innerText = "Please drag one variable into each box!";
    return;
  }

  // Call webR to compute difference in means
  const rCode = `
df <- data.frame(
  student = 1:20,
  treatment = rbinom(20,1,0.5),
  score = 5 + 2*treatment + rnorm(20)
)
mean(df$score[df$treatment==1]) - mean(df$score[df$treatment==0])
  `;
  webr.evalR(rCode).then(res => {
    document.getElementById("effectResult").innerText = "Estimated effect (difference in means): " + res;
  });
}
</script>
