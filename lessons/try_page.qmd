---
title: "Introduction"
webr:  
  show-startup-message: true    # Display status of webR initialization
  packages: ['ggplot2'] # Pre-install dependency
---

## What is Causal Inference


```{webr-r}
#| context: setup
library(tidyverse)
```

<br>

## Question

Compute the difference in means between treated and control groups.

<button onclick="document.getElementById('answer1').style.display='block'">
Reveal correct answer
</button>

<div id="answer1" style="display:none; margin-top:10px;">
üí° **Answer:**
The difference in means is approximately **2.1** ‚Äî same as the regression coefficient on `z`.
</div>

::: {.reveal}
### üí° Answer
The estimated average treatment effect is about **2.1** points.
:::



## Instructions

Match each description on the left with the correct variable type on the right.  

- **Treatment** = variable that we manipulate  
- **Outcome** = variable we measure

| Description | Match |
|-------------|-------|
| 1. Did the student receive the new teaching method? | ‚ùì |
| 2. Test score after the intervention | ‚ùì |
| 3. Whether the patient got a medication | ‚ùì |
| 4. Blood pressure after treatment | ‚ùì |

<details>
<summary>Reveal Answers</summary>

| Description | Answer |
|-------------|-------|
| 1. Did the student receive the new teaching method? | Treatment |
| 2. Test score after the intervention | Outcome |
| 3. Whether the patient got a medication | Treatment |
| 4. Blood pressure after treatment | Outcome |

</details>


## Drag-and-Drop Matching

<div class="drag-exercise" {=html}>
  <div style="display:flex; justify-content:space-between; width:600px;">
    <div id="left" style="width:45%;">
      <div draggable="true" id="item1" style="padding:5px; margin:5px; border:1px solid black;">Student got new method</div>
      <div draggable="true" id="item2" style="padding:5px; margin:5px; border:1px solid black;">Test score after intervention</div>
      <div draggable="true" id="item3" style="padding:5px; margin:5px; border:1px solid black;">Patient received medication</div>
      <div draggable="true" id="item4" style="padding:5px; margin:5px; border:1px solid black;">Blood pressure after treatment</div>
    </div>
    <div id="right" style="width:45%;">
      <div id="treatment" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed blue; margin-bottom:10px; padding:5px;">
        <strong>Treatment</strong>
      </div>
      <div id="outcome" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed green; padding:5px;">
        <strong>Outcome</strong>
      </div>
    </div>
  </div>

  <button onclick="checkAnswer()">Check Answers</button>
  <div id="result" style="margin-top:10px;"></div>

  <script>
    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
    function drop(ev) { ev.preventDefault(); ev.target.appendChild(document.getElementById(ev.dataTransfer.getData("text"))); }

    document.querySelectorAll('#left div').forEach(function(div) { div.addEventListener('dragstart', drag); });

    function checkAnswer() {
      let correct = { "item1":"treatment", "item2":"outcome", "item3":"treatment", "item4":"outcome" };
      let score = 0;
      for (let item in correct) {
        if(document.getElementById(item).parentElement.id === correct[item]) { score += 1; }
      }
      document.getElementById('result').innerText = "You got " + score + " out of 4 correct!";
    }
  </script>
</div>




## Matching Exercise: Treatment vs Outcome

Drag each variable to the correct box, then use the button below to calculate the effect of your treatment.

<div {=html} style="display:flex; justify-content:space-between; width:600px; margin-bottom:20px;">
  <div id="left" style="width:45%;">
    <div draggable="true" id="var1" style="padding:5px; margin:5px; border:1px solid black;">Student got new method</div>
    <div draggable="true" id="var2" style="padding:5px; margin:5px; border:1px solid black;">Test score after intervention</div>
  </div>
  <div id="right" style="width:45%;">
    <div id="treatment" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed blue; margin-bottom:10px; padding:5px;">
      <strong>Treatment</strong>
    </div>
    <div id="outcome" ondrop="drop(event)" ondragover="allowDrop(event)" style="height:120px; border:2px dashed green; padding:5px;">
      <strong>Outcome</strong>
    </div>
  </div>
</div>

<button onclick="computeEffect()">Compute Effect</button>
<div id="effectResult" style="margin-top:10px;"></div>

<script>
function allowDrop(ev) { ev.preventDefault(); }
function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
function drop(ev) { ev.preventDefault(); ev.target.appendChild(document.getElementById(ev.dataTransfer.getData("text"))); }

// attach drag events
document.querySelectorAll('#left div').forEach(div => div.addEventListener('dragstart', drag));

function computeEffect() {
  // find which div is in treatment/outcome boxes
  let treatment = document.getElementById("treatment").children[1]?.innerText || "";
  let outcome   = document.getElementById("outcome").children[1]?.innerText || "";
  
  if(treatment === "" || outcome === "") {
    document.getElementById("effectResult").innerText = "Please drag one variable into each box!";
    return;
  }

  // Call webR to compute difference in means
  const rCode = `
df <- data.frame(
  student = 1:20,
  treatment = rbinom(20,1,0.5),
  score = 5 + 2*treatment + rnorm(20)
)
mean(df$score[df$treatment==1]) - mean(df$score[df$treatment==0])
  `;
  webr.evalR(rCode).then(res => {
    document.getElementById("effectResult").innerText = "Estimated effect (difference in means): " + res;
  });
}
</script>
